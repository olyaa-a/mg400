-- Функція обрізання пробілів
local function trim(s)
  return (s:gsub("^%s*(.-)%s*$", "%1"))
end

-- Функція розбору одного рядка G-code.
-- Приклад: "G01 X100 Y50 Z0" → повертає таблицю { cmd = "G01", params = { X = 100, Y = 50, Z = 0 } }
local function parseLine(line)
  local cmd = line:match("^(G%d+)")
  if not cmd then return nil end
  local params = {}
  for key, value in line:gmatch("([XYZIJR])%s*([-+]?%d+%.?%d*)") do
    params[key] = tonumber(value)
  end
  return { cmd = cmd, params = params }
end

-- Функція обчислення проміжної точки дуги.
-- start, finish – таблиці {x, y}; center – таблиця {cx, cy}; direction – "G02" (за годинниковою) або "G03" (проти).
local function computeArcMidPoint(start, finish, center, direction)
  local angle1 = math.atan2(start[2] - center[2], start[1] - center[1])
  local angle2 = math.atan2(finish[2] - center[2], finish[1] - center[1])
  local dtheta = angle2 - angle1
  if direction == "G02" then  -- за годинниковою стрілкою
    if dtheta > 0 then dtheta = dtheta - 2 * math.pi end
  elseif direction == "G03" then  -- проти годинникової стрілки
    if dtheta < 0 then dtheta = dtheta + 2 * math.pi end
  end
  local midAngle = angle1 + dtheta / 2
  local radius = math.sqrt((start[1] - center[1])^2 + (start[2] - center[2])^2)
  local midX = center[1] + radius * math.cos(midAngle)
  local midY = center[2] + radius * math.sin(midAngle)
  return { midX, midY }
end

-- Поточна позиція робота (за замовчуванням; змініть за потребою)
local currentPos = { X = 0, Y = 0, Z = 0, R = 0 }

-- Функція обробки одного рядка G-code
local function processGCodeLine(line)
  local parsed = parseLine(line)
  if not parsed then return end

  if parsed.cmd == "G00" then
    -- Швидке переміщення (MovJ)
    local p = {
      X = parsed.params.X or currentPos.X,
      Y = parsed.params.Y or currentPos.Y,
      Z = parsed.params.Z or currentPos.Z,
      R = parsed.params.R or currentPos.R
    }
    MovJ({ P = p })
    Sync()
    currentPos = p

  elseif parsed.cmd == "G01" then
    -- Лінійне переміщення (MovL)
    local p = {
      X = parsed.params.X or currentPos.X,
      Y = parsed.params.Y or currentPos.Y,
      Z = parsed.params.Z or currentPos.Z,
      R = parsed.params.R or currentPos.R
    }
    MovL({ P = p })
    Sync()
    currentPos = p

  elseif parsed.cmd == "G02" or parsed.cmd == "G03" then
    -- Аркова інтерполяція (G02: за годинниковою, G03: проти)
    -- Використовуємо I, J як зміщення від поточної позиції до центру дуги
    local center = {
      X = currentPos.X + (parsed.params.I or 0),
      Y = currentPos.Y + (parsed.params.J or 0)
    }
    local endPoint = {
      X = parsed.params.X or currentPos.X,
      Y = parsed.params.Y or currentPos.Y,
      Z = parsed.params.Z or currentPos.Z,
      R = parsed.params.R or currentPos.R
    }
    local midXY = computeArcMidPoint({ currentPos.X, currentPos.Y }, { endPoint.X, endPoint.Y }, { center.X, center.Y }, parsed.cmd)
    local midPoint = { X = midXY[1], Y = midXY[2], Z = endPoint.Z, R = endPoint.R }
    -- Виклик функції Arc. Переконайтеся, що API Arc доступна у вашій версії Dobot Studio.
    Arc({ P = midPoint }, { P = endPoint }, { SpeedL = 50, AccL = 20, CP = 100, SYNC = 1 })
    Sync()
    currentPos = endPoint

  else
    -- Ігноруємо інші команди (наприклад, M3, G21, коментарі, інші заголовки)
    print("Ігнорую команду: " .. parsed.cmd)
  end
end

-- Багаторядковий рядок з G-code (скопіюйте сюди свій повний G-code)
local gcodeText = [[
%
(Header)
(Generated by gcodetools from Inkscape.)
(Using default header. To add your own header create file "header" in the output dir.)
M3
(Header end.)
G21 (All units in mm)

(Start cutting path id: path1)
(Change tool to Default tool)

G00 Z5.000000
G00 X70.153491 Y67.009510

G01 Z-0.100000 F100.0(Penetrate)
G01 X62.055711 Y75.100720 Z-0.100000 F400.000000
G01 X53.863025 Y75.103720 Z-0.100000
G01 X45.670338 Y75.106720 Z-0.100000
G01 X37.099211 Y83.654150 Z-0.100000
G01 X28.528083 Y92.201580 Z-0.100000
G01 X28.528083 Y100.421680 Z-0.100000
G01 X28.528083 Y108.641770 Z-0.100000
G01 X20.436087 Y116.731660 Z-0.100000
G01 X12.344091 Y124.821560 Z-0.100000
G01 X12.344091 Y137.558710 Z-0.100000
G01 X12.344091 Y150.295860 Z-0.100000
G01 X16.230378 Y154.100530 Z-0.100000
G01 X20.116666 Y157.905200 Z-0.100000
G01 X16.230378 Y161.820450 Z-0.100000
G01 X12.344091 Y165.735690 Z-0.100000
G01 X12.344091 Y178.394020 Z-0.100000
G01 X12.344091 Y191.052360 Z-0.100000
G01 X20.436087 Y199.142252 Z-0.100000
G01 X28.528083 Y207.232146 Z-0.100000
G01 X28.528083 Y215.432652 Z-0.100000
G01 X28.528083 Y223.633158 Z-0.100000
G01 X37.100185 Y232.203300 Z-0.100000
G01 X45.672286 Y240.773441 Z-0.100000
G01 X53.863356 Y240.773441 Z-0.100000
G01 X62.054426 Y240.773441 Z-0.100000
G01 X70.156507 Y248.865437 Z-0.100000
G01 X78.258588 Y256.957432 Z-0.100000
G01 X85.178569 Y256.957432 Z-0.100000
G01 X92.098549 Y256.957432 Z-0.100000
G01 X95.023721 Y254.026651 Z-0.100000
G01 X97.948893 Y251.095870 Z-0.100000
G01 X97.948893 Y226.287418 Z-0.100000
G01 X97.948893 Y201.478966 Z-0.100000
G01 X95.018112 Y198.553794 Z-0.100000
G01 X92.087331 Y195.628620 Z-0.100000
G01 X78.940593 Y195.628620 Z-0.100000
G01 X65.793856 Y195.628620 Z-0.100000
G01 X65.793856 Y165.338020 Z-0.100000
G01 X65.793856 Y135.047410 Z-0.100000
G01 X73.086142 Y127.752820 Z-0.100000
G01 X80.378429 Y120.458240 Z-0.100000
G01 X86.238489 Y120.458240 Z-0.100000
G01 X92.098549 Y120.458240 Z-0.100000
G01 X95.023721 Y117.527460 Z-0.100000
G01 X97.948893 Y114.596680 Z-0.100000
G01 X97.948893 Y89.681750 Z-0.100000
G01 X97.948893 Y64.766830 Z-0.100000
G01 X95.018112 Y61.841660 Z-0.100000
G01 X92.087331 Y58.916480 Z-0.100000
G01 X85.169301 Y58.917270 Z-0.100000
G01 X78.251271 Y58.918050 Z-0.100000
G01 X70.153491 Y67.009510 Z-0.100000
G00 Z5.000000
(End cutting path id: path1)

(Start cutting path id: path1)
(Change tool to Default tool)

G00 Z5.000000
G00 X71.999872 Y71.817330

G01 Z-0.100000 F100.0(Penetrate)
G01 X64.044895 Y79.785560 Z-0.100000 F400.000000
G01 X55.861923 Y79.785560 Z-0.100000
G01 X47.678951 Y79.785560 Z-0.100000
G01 X40.575611 Y86.882810 Z-0.100000
G01 X33.472271 Y93.980050 Z-0.100000
G01 X33.382191 Y100.564670 Z-0.100000
G02 X33.332031 Y107.140196 Z-0.100000 I543.376553 J7.432991
G02 X33.371561 Y107.309000 Z-0.100000 I0.377640 J0.000596
G02 X33.499455 Y107.390400 Z-0.100000 I0.131498 J-0.065434
G02 X39.881599 Y107.468710 Z-0.100000 I6.382144 J-260.028661
G01 X46.312193 Y107.468710 Z-0.100000
G01 X51.927693 Y101.850210 Z-0.100000
G01 X57.543194 Y96.231710 Z-0.100000
G01 X57.276227 Y95.118860 Z-0.100000
G03 X58.010578 Y90.424679 Z-0.100000 I6.066910 J-1.455432
G03 X61.739635 Y87.769930 Z-0.100000 I4.949615 J3.006166
G03 X66.965916 Y88.983989 Z-0.100000 I1.325783 J6.148847
G03 X69.254248 Y93.709540 Z-0.100000 I-3.735115 J4.725551
G03 X66.814531 Y98.599445 Z-0.100000 I-6.120256 J-0.000000
G03 X61.492370 Y99.551760 Z-0.100000 I-3.602761 J-4.786570
G01 X60.655104 Y99.300900 Z-0.100000
G01 X54.332621 Y105.620750 Z-0.100000
G01 X48.010139 Y111.940600 Z-0.100000
G01 X39.963865 Y111.940600 Z-0.100000
G01 X31.917591 Y111.940600 Z-0.100000
G01 X24.579734 Y119.270070 Z-0.100000
G01 X17.241877 Y126.599530 Z-0.100000
G01 X17.241877 Y137.465180 Z-0.100000
G01 X17.241877 Y148.330830 Z-0.100000
G01 X17.721008 Y148.842190 Z-0.100000
G02 X18.210536 Y149.343333 Z-0.100000 I12.285390 J-11.511007
G02 X21.528000 Y152.580640 Z-0.100000 I516.547784 J-526.019135
G01 X24.855861 Y155.807740 Z-0.100000
G01 X32.324844 Y155.807740 Z-0.100000
G01 X39.793827 Y155.807740 Z-0.100000
G01 X40.430403 Y154.882500 Z-0.100000
G03 X42.846621 Y152.663393 Z-0.100000 I6.050232 J4.162668
G03 X45.670337 Y151.898690 Z-0.100000 I2.889694 J5.074657
G03 X51.244419 Y155.448189 Z-0.100000 I0.068304 J6.044215
G03 X50.264876 Y162.038730 Z-0.100000 I-5.597234 J2.536155
G03 X44.999937 Y164.061001 Z-0.100000 I-4.558025 J-4.002009
G03 X40.436256 Y160.885390 Z-0.100000 I0.686966 J-5.854288
G01 X40.018579 Y160.066680 Z-0.100000
G01 X32.412201 Y160.066680 Z-0.100000
G01 X24.805824 Y160.066680 Z-0.100000
G01 X21.023850 Y163.844280 Z-0.100000
G01 X17.241877 Y167.621870 Z-0.100000
G01 X17.241877 Y178.379070 Z-0.100000
G01 X17.241877 Y189.136260 Z-0.100000
G01 X24.642919 Y196.535040 Z-0.100000
G01 X32.043962 Y203.933815 Z-0.100000
G01 X40.027050 Y203.933815 Z-0.100000
G01 X48.010139 Y203.933815 Z-0.100000
G01 X54.313787 Y210.234837 Z-0.100000
G01 X60.617436 Y216.535858 Z-0.100000
G01 X61.448830 Y216.305021 Z-0.100000
G03 X66.837700 Y217.316762 Z-0.100000 I1.664131 J5.993616
G03 X69.254248 Y222.140806 Z-0.100000 I-3.606736 J4.824044
G03 X67.656948 Y226.242629 Z-0.100000 I-6.065333 J0.000000
G03 X63.727990 Y228.160446 Z-0.100000 I-4.407710 J-4.046445
G03 X61.369024 Y227.926074 Z-0.100000 I-0.532291 J-6.631218
G03 X59.434069 Y226.934280 Z-0.100000 I1.536750 J-5.381554
G03 X57.476895 Y224.192561 Z-0.100000 I3.758570 J-4.752477
G03 X57.257870 Y220.748256 Z-0.100000 I5.999660 J-2.110637
G01 X57.503497 Y219.602937 Z-0.100000
G01 X51.799865 Y213.895326 Z-0.100000
G01 X46.096232 Y208.187716 Z-0.100000
G01 X39.707814 Y208.243476 Z-0.100000
G01 X33.319396 Y208.299236 Z-0.100000
G01 X33.393866 Y215.007075 Z-0.100000
G01 X33.468336 Y221.714913 Z-0.100000
G01 X40.632897 Y228.901883 Z-0.100000
G01 X47.797457 Y236.088853 Z-0.100000
G01 X55.998166 Y236.088853 Z-0.100000
G01 X64.198876 Y236.088853 Z-0.100000
G01 X72.182269 Y244.074375 Z-0.100000
G01 X80.165662 Y252.059897 Z-0.100000
G01 X85.176699 Y252.059897 Z-0.100000
G01 X90.187735 Y252.059897 Z-0.100000
G01 X91.619418 Y250.617159 Z-0.100000
G01 X93.051101 Y249.174421 Z-0.100000
G01 X93.051101 Y226.282224 Z-0.100000
G01 X93.051101 Y203.390027 Z-0.100000
G01 X91.608363 Y201.958344 Z-0.100000
G01 X90.165625 Y200.526661 Z-0.100000
G01 X75.637318 Y200.526661 Z-0.100000
G01 X61.109011 Y200.526661 Z-0.100000
G01 X61.109011 Y192.771502 Z-0.100000
G02 X61.047164 Y185.027812 Z-0.100000 I-484.816826 J0.000000
G02 X60.979754 Y184.679502 Z-0.100000 I-1.017556 J0.016255
G02 X60.737905 Y184.506471 Z-0.100000 I-0.252011 J0.096707
G02 X52.038640 Y184.342672 Z-0.100000 I-8.699265 J230.923989
G01 X43.226782 Y184.342672 Z-0.100000
G01 X42.721733 Y185.141222 Z-0.100000
G03 X40.294578 Y187.465089 Z-0.100000 I-5.896842 J-3.729487
G03 X37.258916 Y188.272422 Z-0.100000 I-3.031986 J-5.289724
G03 X35.701776 Y188.108948 Z-0.100000 I0.004532 J-7.541022
G03 X34.577906 Y187.704902 Z-0.100000 I0.908613 J-4.292412
G03 X32.951434 Y186.520976 Z-0.100000 I3.169149 J-6.062944
G03 X31.858390 Y185.031872 Z-0.100000 I4.043288 J-4.113602
G03 X31.225480 Y182.469331 Z-0.100000 I5.149688 J-2.631327
G03 X31.795870 Y179.776302 Z-0.100000 I6.289377 J-0.074815
G03 X36.458853 Y176.278410 Z-0.100000 I5.549179 J2.540502
G03 X41.928810 Y178.289192 Z-0.100000 I0.885804 J6.035725
G03 X42.556292 Y179.099308 Z-0.100000 I-6.264220 J5.500073
G03 X42.805414 Y179.577332 Z-0.100000 I-1.907012 J1.297764
G01 X42.999706 Y180.088352 Z-0.100000
G01 X52.001119 Y180.032752 Z-0.100000
G01 X61.002532 Y179.977252 Z-0.100000
G01 X61.069902 Y171.459362 Z-0.100000
G02 X61.088328 Y162.941546 Z-0.100000 I-741.017113 J-5.861906
G02 X60.991092 Y149.472552 Z-0.100000 I-1852.683298 J6.640110
G01 X60.844905 Y136.003642 Z-0.100000
G01 X51.946930 Y136.003642 Z-0.100000
G01 X43.048955 Y136.003642 Z-0.100000
G01 X42.500528 Y136.939462 Z-0.100000
G03 X40.298835 Y139.103040 Z-0.100000 I-5.102267 J-2.990124
G03 X37.268200 Y139.884292 Z-0.100000 I-2.981736 J-5.297910
G03 X31.442135 Y135.225446 Z-0.100000 I0.048481 J-6.032909
G03 X34.577899 Y128.382472 Z-0.100000 I5.981335 J-1.399041
G03 X35.701769 Y127.978422 Z-0.100000 I2.032538 J3.888471
G03 X37.258909 Y127.814942 Z-0.100000 I1.561672 J7.377291
G03 X40.267997 Y128.616248 Z-0.100000 I0.002477 J6.041261
G03 X42.714996 Y130.946142 Z-0.100000 I-3.537570 J6.165316
G01 X43.226775 Y131.744702 Z-0.100000
G01 X52.747069 Y131.744702 Z-0.100000
G01 X62.267362 Y131.744702 Z-0.100000
G01 X70.369443 Y123.652702 Z-0.100000
G01 X78.471524 Y115.560702 Z-0.100000
G01 X84.329626 Y115.560702 Z-0.100000
G01 X90.187728 Y115.560702 Z-0.100000
G01 X91.619411 Y114.117972 Z-0.100000
G01 X93.051094 Y112.675232 Z-0.100000
G01 X93.051094 Y89.676562 Z-0.100000
G01 X93.051094 Y66.677892 Z-0.100000
G01 X91.608356 Y65.246202 Z-0.100000
G01 X90.165618 Y63.814522 Z-0.100000
G01 X85.060227 Y63.831822 Z-0.100000
G01 X79.954837 Y63.849122 Z-0.100000
G01 X71.999872 Y71.817330 Z-0.100000
G00 Z5.000000
(End cutting path id: path1)

(Start cutting path id: path1)
(Change tool to Default tool)

G00 Z5.000000
G00 X91.288562 Y65.565180

G01 Z-0.100000 F100.0(Penetrate)
G01 X92.625212 Y66.889950 Z-0.100000 F400.000000
G01 X92.625212 Y89.675730 Z-0.100000
G01 X92.625212 Y112.461510 Z-0.100000
G01 X91.300443 Y113.798160 Z-0.100000
G01 X89.975674 Y115.134810 Z-0.100000
G01 X84.124411 Y115.134810 Z-0.100000
G01 X78.273148 Y115.134810 Z-0.100000
G01 X70.148190 Y123.226800 Z-0.100000
G01 X62.023232 Y131.318800 Z-0.100000
G01 X52.764675 Y131.318800 Z-0.100000
G01 X43.506119 Y131.318800 Z-0.100000
G01 X42.833701 Y130.281080 Z-0.100000
G02 X38.162924 Y127.344037 Z-0.100000 I-5.499704 J3.563686
G02 X32.893370 Y129.013550 Z-0.100000 I-0.832010 J6.524907
G02 X31.350042 Y131.174306 Z-0.100000 I4.294627 J4.698993
G02 X30.779525 Y133.875400 Z-0.100000 I6.310470 J2.743678
G02 X30.934258 Y135.436148 Z-0.100000 I7.482222 J0.046257
G02 X31.358778 Y136.677900 Z-0.100000 I5.129543 J-1.060206
G02 X33.775347 Y139.352977 Z-0.100000 I5.865750 J-2.869850
G02 X37.258921 Y140.348040 Z-0.100000 I3.483574 J-5.600217
G02 X40.507162 Y139.515613 Z-0.100000 I0.000000 J-6.753747
G02 X42.929944 Y137.237100 Z-0.100000 I-3.195503 J-5.825183
G01 X43.439735 Y136.429530 Z-0.100000
G01 X51.929378 Y136.429530 Z-0.100000
G01 X60.419022 Y136.429530 Z-0.100000
G01 X60.565271 Y149.898450 Z-0.100000
G03 X60.663012 Y163.367421 Z-0.100000 I-1869.788813 J20.303434
G03 X60.644081 Y171.459360 Z-0.100000 I-674.950422 J2.466954
G01 X60.576641 Y179.551350 Z-0.100000
G01 X52.024365 Y179.606950 Z-0.100000
G01 X43.472088 Y179.662550 Z-0.100000
G01 X43.040753 Y178.968070 Z-0.100000
G02 X40.612039 Y176.591381 Z-0.100000 I-6.061138 J3.764532
G02 X37.578336 Y175.737150 Z-0.100000 I-3.124622 J5.282696
G02 X33.980718 Y176.686652 Z-0.100000 I-0.102330 J6.902626
G02 X31.527085 Y179.290020 Z-0.100000 I3.231148 J5.503244
G02 X30.982661 Y180.760319 Z-0.100000 I5.978118 J3.049531
G02 X30.799515 Y182.295030 Z-0.100000 I6.338662 J1.534711
G02 X30.959302 Y183.836769 Z-0.100000 I7.517812 J0.000000
G02 X31.378099 Y185.056350 Z-0.100000 I5.092500 J-1.067040
G02 X36.922835 Y188.772596 Z-0.100000 I5.978003 J-2.924768
G02 X42.835240 Y185.803820 Z-0.100000 I0.425638 J-6.524082
G01 X43.509202 Y184.763720 Z-0.100000
G01 X52.042922 Y184.819320 Z-0.100000
G01 X60.576641 Y184.874920 Z-0.100000
G01 X60.632441 Y192.913670 Z-0.100000
G01 X60.688241 Y200.952434 Z-0.100000
G01 X75.320076 Y200.952434 Z-0.100000
G01 X89.951911 Y200.952434 Z-0.100000
G01 X91.288561 Y202.277202 Z-0.100000
G01 X92.625211 Y203.601971 Z-0.100000
G01 X92.625211 Y226.281396 Z-0.100000
G01 X92.625211 Y248.960701 Z-0.100000
G01 X91.300442 Y250.297351 Z-0.100000
G01 X89.975673 Y251.634001 Z-0.100000
G01 X85.177143 Y251.634001 Z-0.100000
G01 X80.378613 Y251.634001 Z-0.100000
G01 X72.395220 Y243.648479 Z-0.100000
G01 X64.411827 Y235.662957 Z-0.100000
G01 X56.218828 Y235.662957 Z-0.100000
G01 X48.025828 Y235.662957 Z-0.100000
G01 X40.955802 Y228.582460 Z-0.100000
G01 X33.885777 Y221.501964 Z-0.100000
G01 X33.815537 Y215.113546 Z-0.100000
G01 X33.745297 Y208.725129 Z-0.100000
G01 X39.801653 Y208.668509 Z-0.100000
G01 X45.858008 Y208.611889 Z-0.100000
G01 X51.436690 Y214.176027 Z-0.100000
G01 X57.015372 Y219.740164 Z-0.100000
G01 X56.801492 Y220.514593 Z-0.100000
G02 X56.873158 Y224.008895 Z-0.100000 I5.891359 J1.627057
G02 X58.930948 Y227.151525 Z-0.100000 I6.722679 J-2.156967
G02 X60.777281 Y228.216991 Z-0.100000 I3.573018 J-4.059162
G02 X63.329665 Y228.633622 Z-0.100000 I2.541388 J-7.542587
G02 X69.571659 Y223.503018 Z-0.100000 I-0.008783 J-6.373054
G02 X65.817162 Y216.119024 Z-0.100000 I-6.570000 J-1.305901
G02 X64.632960 Y215.776641 Z-0.100000 I-1.707117 J3.685316
G02 X62.599828 Y215.701319 Z-0.100000 I-1.424421 J10.971456
G01 X60.530403 Y215.815351 Z-0.100000
G01 X54.379434 Y209.661638 Z-0.100000
G01 X48.228466 Y203.507926 Z-0.100000
G01 X40.240409 Y203.507926 Z-0.100000
G01 X32.252352 Y203.507926 Z-0.100000
G01 X24.960065 Y196.213345 Z-0.100000
G01 X17.667778 Y188.918755 Z-0.100000
G01 X17.667778 Y178.381225 Z-0.100000
G01 X17.667778 Y167.843695 Z-0.100000
G01 X21.338837 Y164.168135 Z-0.100000
G01 X25.009895 Y160.492575 Z-0.100000
G01 X32.302950 Y160.492575 Z-0.100000
G01 X39.596005 Y160.492575 Z-0.100000
G01 X40.107825 Y161.291135 Z-0.100000
G02 X42.563863 Y163.593385 Z-0.100000 I5.779282 J-3.704156
G02 X45.776818 Y164.427695 Z-0.100000 I3.231366 J-5.840346
G02 X47.336079 Y164.268287 Z-0.100000 I0.022662 J-7.484069
G02 X48.579320 Y163.840155 Z-0.100000 I-1.083868 J-5.166582
G02 X51.256575 Y161.417888 Z-0.100000 I-2.889917 J-5.884809
G02 X52.250693 Y157.937215 Z-0.100000 I-5.596323 J-3.480673
G02 X51.807338 Y155.526370 Z-0.100000 I-6.776443 J0.000000
G02 X50.552401 Y153.475945 Z-0.100000 I-6.091062 J2.318712
G02 X45.398328 Y151.413588 Z-0.100000 I-4.682333 J4.230206
G02 X40.333581 Y154.242025 Z-0.100000 I0.515120 J6.871221
G01 X39.507750 Y155.381845 Z-0.100000
G01 X32.274899 Y155.381845 Z-0.100000
G01 X25.042048 Y155.381845 Z-0.100000
G01 X21.354913 Y151.716465 Z-0.100000
G01 X17.667778 Y148.051085 Z-0.100000
G01 X17.667778 Y137.503375 Z-0.100000
G01 X17.667778 Y126.955665 Z-0.100000
G01 X24.960065 Y119.661085 Z-0.100000
G01 X32.252352 Y112.366495 Z-0.100000
G01 X40.237722 Y112.366495 Z-0.100000
G01 X48.223093 Y112.366495 Z-0.100000
G01 X54.518145 Y106.074075 Z-0.100000
G03 X60.881245 Y100.099449 Z-0.100000 I98.690019 J98.731182
G03 X61.400867 Y100.005075 Z-0.100000 I0.338000 J0.383318
G02 X63.153751 Y100.300559 Z-0.100000 I1.619315 J-4.259168
G02 X65.444066 Y99.886495 Z-0.100000 I-0.228970 J-7.807758
G02 X67.645671 Y98.562831 Z-0.100000 I-1.960410 J-5.753442
G02 X69.211807 Y96.346505 Z-0.100000 I-4.644988 J-4.943823
G02 X69.759315 Y93.688863 Z-0.100000 I-5.942184 J-2.609383
G02 X69.172587 Y91.071775 Z-0.100000 I-6.340403 J0.047148
G02 X67.860360 Y89.147989 Z-0.100000 I-6.434188 J2.979369
G02 X66.087427 Y87.848945 Z-0.100000 I-4.562676 J4.367762
G02 X59.891366 Y88.036485 Z-0.100000 I-2.921262 J5.933933
G02 X56.676130 Y93.212325 Z-0.100000 I3.164072 J5.552098
G02 X56.676299 Y94.598860 Z-0.100000 I11.730143 J0.691834
G02 X56.803792 Y95.367965 Z-0.100000 I3.708547 J-0.219637
G01 X57.013747 Y96.128365 Z-0.100000
G01 X51.553488 Y101.585585 Z-0.100000
G01 X46.093230 Y107.042815 Z-0.100000
G01 X39.919266 Y107.042925 Z-0.100000
G01 X33.745302 Y107.043025 Z-0.100000
G01 X33.812052 Y100.707745 Z-0.100000
G01 X33.878802 Y94.372455 Z-0.100000
G01 X40.944590 Y87.291965 Z-0.100000
G01 X48.010378 Y80.211465 Z-0.100000
G01 X56.211104 Y80.211465 Z-0.100000
G01 X64.411831 Y80.211465 Z-0.100000
G01 X72.395224 Y72.225945 Z-0.100000
G01 X80.378617 Y64.240415 Z-0.100000
G01 X85.165266 Y64.240415 Z-0.100000
G01 X89.951915 Y64.240415 Z-0.100000
G01 X91.288562 Y65.565180 Z-0.100000
G00 Z5.000000
(End cutting path id: path1)
]]

-- Обробка кожного рядка з G-code
for line in gcodeText:gmatch("[^\r\n]+") do
  local trimmed = trim(line)
  -- Ігнорувати порожні рядки та рядки, що починаються з коментарів або заголовків
  if trimmed ~= "" and not trimmed:match("^%%") and not trimmed:match("^%(") then
    processGCodeLine(trimmed)
  end
end

print("Обробка G-code завершена")
